#https://clouddocs.f5.com/products/extensions/f5-appsvcs-extension/latest/userguide/installation.html#success
#https://github.com/F5Networks/terraform-provider-bigip/blob/master/examples/as3/as3.tf
#https://github.com/F5Networks/terraform-provider-bigip/tree/master/examples/as3

provider "bigip" {
   address = "13.67.54.200:8443"
   username = "admin"
   password = "admin@Demo"
   #username = file("${var.user}")
   #password = file("${var.passwd}")
}

#resource "bigip_as3" "as3-demo1" {
#  #as3_json = templatefile(
  #  "/tf/caf/landingzones/landingzone_vdc_demo/blueprint_f5bigip_transit/as3.tmpl",)
   # {
   #   tenant_name = jsonencode(var.tenant_name)
   # })
  #tenant_name = var.tenant_name
#  as3_json = "${file("/tf/caf/landingzones/landingzone_vdc_demo/blueprint_f5bigip_transit/as3.tmpl")}"
#}

## Using  provisioner to install as3 rpm on bigip pass arguments as BIG-IP IP address, credentials and name of the rpm 
resource "null_resource" "install_as3" {
  provisioner "local-exec" {
    #command = "sh install_as3.sh 13.67.54.200 admin:admin@Demo ./f5-appsvcs-3.16.0-6.noarch.rpm"
    command = "echo 'passing'"
  }
}

# The below null resource can be used to deploy HTTP script as3_http.sh which uses JSON payload example1.josn 
resource "null_resource" "deploy_as3_http" {
 provisioner "local-exec" {
    #command = "sh /tf/caf/landingzones/landingzone_vdc_demo/blueprint_f5bigip_transit/as3_http.sh"
    command = "sh /tf/caf/landingzones/landingzone_vdc_demo/blueprint_f5bigip_transit/scripts/as3_http.sh"
  }
    depends_on = [null_resource.install_as3]
}